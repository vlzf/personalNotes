# 同源策略及跨域方法

## 一、什么是同源策略
同源策略（Sameoriginpolicy）是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。可以说Web是构建在同源策略基础之上的，浏览器只是针对同源策略的一种实现。

***

## 二、同源策略的基本内容
- 所谓同源，就是协议相同、域名相同、IP地址相同、端口号相同。如：
```text
http://192.13.103.7:8080/A.html
```
以下同源的是：
```text
http://196.150.103.5:8080/a.html    不同源：IP地址不同

https://192.13.103.7:8080/a.html    不同源：协议不同

http://192.13.103.7:7070/a.html    不同源：端口号不同

http://192.13.103.7:8080/a.html    同源
```
> PS: 如果一国页面的 url 是域名形式，另一个是 IP 形式，那么，即使域名和 IP 都指向同一个地址，也属于不同源。

***

## 三、安全性
有这种限制的主要原因就是如果没有同源策略将导致安全风险。

http 是无状态协议。当用户登录一个网站并且在该网站的不同页面跳转时，我们需要判断、保持用户登录状态，而不是每跳转一次页面都要登录一次，这时需要借用客户端的 cookie 来实现。这时，我们跳转页面时，就能通过获取该 cookie 得知用户登录信息（cookie可以说是一种权限票据）。

问题就在这里，一个用户用同一个浏览器登录了多个不同的网站，它们都需要设置 cookie，所以不可能使用同一个 cookie，而是要为不同的网站创建各自的、独立的 cookie。

有这么多的 cookie 该使用哪一个？每个网站应当使用属于自己的 cookie。但是，总有恶意网站会想要获取你在其他网站的 cookie 来获取你的用户权限，从而进行违法犯罪。例如：获取你的某银行用户权限盗取你的钱财。

同源策略的限制：
- 非同源的两个网页不能直接通过 js 脚本获取对方的 cookie。
- 服务器不接受非同源网站的请求（除非服务器有跨域设置）。
- web浏览器允许第一个页面的脚本访问第二个页面里的数据，但是也只有在两个页面有相同的源时。

在服务端没有设置跨域的情况下，非同源脚本向服务端发跨域请求，服务端是不会拒绝的，浏览器也是能接收到服务端的响应的，但浏览器把响应结果拦截了。

***

## 四、跨域手段
1. [JSONP 跨域](./jsonp请求原理及实现.md)。需要前后端配合。
2. 后台设置 `Access-Control-Allow-Origin` 响应头跨域。
3. 使用代理服务器。
4. 设置 `document.domain` 属性。
5. `WebSocket`。
6. `window.name`。
7. `window.postMessage`。
8. `hash` 值。
9. `localStorage` 

***

END